<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Upload ECG - ECG Backend</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Upload ECG";
        var mkdocs_page_input_path = "ecg_create.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ECG Backend
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../installation/docker/">Docker</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">OAuth2 Authentication</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../auth/create_users/">Creating Users</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../auth/user_login/">Login as User</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">API Endpoints</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../api/">Intro</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Upload ECG</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#technical-considerations">Technical considerations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ecg-signal-processors">ECG Signal processors</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#adding-signal-processors">Adding Signal processors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#numcrosseszerosignalprocessor">NumCrossesZeroSignalProcessor</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ecg_detail/">ECG Detail</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tests/">Testing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ECG Backend</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
          <li class="breadcrumb-item">API Endpoints</li>
      <li class="breadcrumb-item active">Upload ECG</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="upload-ecg">Upload ECG</h1>
<p>To upload an ECG, you need to be logged in as a user. If you are not logged in, you can follow the instructions in the <a href="../auth/user_login/">User login</a> section.</p>
<p>Once you are logged in, go to <a href="http://localhost:8000/api/docs">http://localhost:8000/api/docs</a> and click on the <code>POST /ecgs/</code> endpoint. Then, fill in the form with the following data:</p>
<ul>
<li>file: <code>&lt;file&gt;</code></li>
</ul>
<p><img alt="Upload ECG" src="../img/upload_ecg_1.jpg" title="Screenshot of the Upload ECG form" /></p>
<p>Once you click on the <code>Execute</code> button, you will see the response with the new ECG data.</p>
<p><img alt="Upload ECG response" src="../img/upload_ecg_2.jpg" title="Screenshot of the Upload ECG response" /></p>
<p>Now you can list the ECGs and view the details of the new ECG.</p>
<p>List ECGs: <a href="http://localhost:8000/api/docs#/ECGs/list_ecgs_ecgs_get">http://localhost:8000/api/docs#/ECGs/list_ecgs_ecgs_get</a></p>
<p><img alt="List ECGs" src="../img/upload_ecg_3.jpg" title="Screenshot of the List ECGs" /></p>
<h2 id="technical-considerations">Technical considerations</h2>
<p>The API is designed to be performant and scalable. You can upload
big JSON files, since the app uses a streaming approach to parse the data and store it in the database.</p>
<p>The JSON file is parsed in streaming using <a href="https://github.com/ICRAR/ijson?tab=readme-ov-file#lower-level-interfaces">ijson</a> library and the data is sent to the database in chunks. This way, the app can handle big files without consuming a lot of memory.</p>
<h2 id="ecg-signal-processors">ECG Signal processors</h2>
<p>Every time you upload an ECG, the app will first store the raw data in the database and then it triggers background tasks to process the data and store the results in the database.</p>
<h3 id="adding-signal-processors">Adding Signal processors</h3>
<p>There is an abstract base class <code>SignalProcessor</code> that you can use to create new signal processors. You can find the base class in the <code>ecg_backend.processors</code> module.</p>
<p>To create a new signal processor, you need to create a new class that inherits from <code>SignalProcessor</code> and implement the <code>process</code> method. This method will receive the ECG data and should return the processed data.</p>
<p>There is no need to register the new processor in the app. The app will automatically find the new processor and trigger it when an ECG is uploaded.</p>
<p>In this case I opted to use introspection to find the processors
to avoid more external dependencies, but this feature can also be implemented using the <a href="https://en.wikipedia.org/wiki/Observer_pattern">Observer design pattern</a>.</p>
<h3 id="numcrosseszerosignalprocessor">NumCrossesZeroSignalProcessor</h3>
<p>This processor calculates the number of times the signal crosses the zero line. You can find the implementation in the <code>ecg_backend.processors.num_crosses_zero</code> module.</p>
<p>The implementation uses a raw PostgreSQL query to calculate the number of times the signal crosses the zero line. It is a simple
way to implement it, since the data is already stored in the PostgreSQL database, but in future implementations, we could use a more efficient way to calculate this value.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../api/" class="btn btn-neutral float-left" title="Intro"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ecg_detail/" class="btn btn-neutral float-right" title="ECG Detail">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../api/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ecg_detail/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
